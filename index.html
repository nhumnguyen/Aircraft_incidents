<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v3.min.js"></script>
<style type="text/css">

/* On mouse hover, lighten state color */
path:hover {
	fill-opacity: .7;
}

/* Style for Custom Tooltip */
div.tooltip {
 	position: absolute;
	text-align: center;
	width: 200px;
	height: 100px;
	padding: 2px;
	font: 12px sans-serif;
	background: white;
	border: 0px;
	border-radius: 8px;
	pointer-events: none;


}

/* Legend Font Style */
body {
	font: 11px sans-serif;
}

/* Legend Position Style */
.legend {
	position:absolute;
	left:800px;
	top:350px;
}

</style>
</head>
<body>
<form>
<label><input type="radio" name="dataset" value="apples" checked> Apples</label>
<label><input type="radio" name="dataset" value="oranges"> Oranges</label>
<label><input type="radio" name="dataset" value="oranges"> Oranges</label>
</form>
<script type="text/javascript">


//Width and height of map
var width = 960;
var height = 500;

// D3 Projection
var projection = d3.geo.albersUsa()
				   .translate([width/2, height/2])    // translate to center of screen
				   .scale([1000]);          // scale things down so see entire US

// Define path generator
var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
		  	 .projection(projection);  // tell path generator to use albersUsa projection


// Define linear scale for output
var color = d3.scale.linear()
			  .range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]);

var legendText = ["Cities Lived", "States Lived", "States Visited", "Nada"];

//Create SVG element and append map to the SVG
var svg = d3.select("body")
			.append("svg")
			.attr("width", width)
			.attr("height", height);

// Append Div for tooltip to SVG
var ttdiv = d3.select("body")
		    .append("div")
    		.attr("class", "tooltip")
    		.style("opacity", 1);


var ttheader = ttdiv.append("p")
								.attr("class", "ttheader")
								.style("fill", "red");

// Load in my states data!
d3.csv("stateslived.csv", function(data) {
				color.domain([0,1,2,3]); // setting the range of the input data

					// Load GeoJSON data and merge with states data
				d3.json("us-states.json", function(json) {

							// Loop through each state data value in the .csv file
							for (var i = 0; i < data.length; i++) {
										var dataState = data[i].state; //name
										var dataValue = data[i].visited;

										// Find the corresponding state inside the GeoJSON
										for (var j = 0; j < json.features.length; j++)  {
															var jsonState = json.features[j].properties.name;

																if (dataState == jsonState) {

																			// Copy the data value into the JSON
																			json.features[j].properties.visited = dataValue;

																			// Stop looking through the JSON
																			break;
																}
										}
								}

							// Bind the data to the SVG and create one path per GeoJSON feature
							svg.selectAll("path")
								.data(json.features)
								.enter()
								.append("path")
								.attr("d", path)
								.style("stroke", "#fff")
								.style("stroke-width", "1")
								.style("fill", "black");


// Map the cities I have lived in!
d3.csv("aircraft_incidents.csv", function(data) {

			svg.selectAll("circle")
				.data(data)
				.enter()
				.append("circle")
				.attr("cx", function(d) {
					var proj = projection([d.Longitude, d.Latitude]);
					if (d.Latitude == "" || d.Longitude == "" || proj == null) { return;}
					return proj[0];
				})
				.attr("cy", function(d) {
					var proj = projection([d.Longitude, d.Latitude]);
					if (d.Latitude == "" || d.Longitude == "" || proj == null) { return;}
					return proj[1];
				})
				.attr("r", function(d) {
					// return Math.sqrt(d.Total_Uninjured) * 4;
					return 4;
				})
					.style("fill", "rgb(217,91,67)")
					.style("opacity", 1)

						.on("click", function(d) {
							var ttdata = ["Location: " + d.Location, "Date: " + d.Event_Date,
														"Airport Name: " + d.Airport_Name, "Registration Number: " + d.Registration_Number,
													"Model: " + d.Model, "Injury Severity: " + d.Injury_Severity];
					    	ttdiv.transition()
					      	   .duration(200)
					           .style("opacity", .9);
										 // ttdiv.text(d.Location)
										 ttdiv.html(ttdata.join('<br/>'))
		 								           .style("left", (d3.event.pageX) + "px")
		 								           .style("top", (d3.event.pageY - 28) + "px");

							 	})

    					// fade out tooltip on mouse out
				    .on("mouseout", function(d) {
				        ttdiv.transition()
				           .duration(500)
				           .style("opacity", 0);
				    });
		});


// Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
var legend = d3.select("body").append("svg")
      			.attr("class", "legend")
     			.attr("width", 140)
    			.attr("height", 200)
   				.selectAll("g")
   				.data(color.domain().slice().reverse())
   				.enter()
   				.append("g")
     			.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  	legend.append("rect")
   		  .attr("width", 18)
   		  .attr("height", 18)
   		  .style("fill", color);

  	legend.append("text")
  		  .data(legendText)
      	  .attr("x", 24)
      	  .attr("y", 9)
      	  .attr("dy", ".35em")
      	  .text(function(d) { return d; });
	});

});



//======================================================================
//======================================================================
//======================================================================

		var pcolor = d3.scale.category20();
		var radius =  Math.min(width, height) / 2;
		var pie = d3.layout.pie()
		    .value(function(d) { return d.apples; })
		    .sort(null);

		var arc = d3.svg.arc()
		    .innerRadius(radius - 100)
		    .outerRadius(radius - 20);
		var svg2 = d3.select("body").append("svg")
		    .attr("width", width)
		    .attr("height", height)
		  .append("g")
		    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		d3.tsv("data.tsv", type, function(error, data) {
		  if (error) throw error;

		  var path = svg2.datum(data).selectAll("path")
		      .data(pie)
		    .enter().append("path")
		      .attr("fill", function(d, i) { return pcolor(i); })
		      .attr("d", arc)
		      .each(function(d) { this._current = d; }); // store the initial angles

		  d3.selectAll("input")
		      .on("change", change);

		  var timeout = setTimeout(function() {
		    d3.select("input[value=\"oranges\"]").property("checked", true).each(change);
		  }, 2000);


			function change() {
					 var value = this.value;
					 clearTimeout(timeout);
					 pie.value(function(d) { return d[value]; }); // change the value function
					 path = path.data(pie); // compute the new angles
					 path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
 			 	}
			});

		function type(d) {
				 d.apples = +d.apples;
				 d.oranges = +d.oranges;
				 return d;
		}

			// Store the displayed angles in _current.
			// Then, interpolate from _current to the new angles.
			// During the transition, _current is updated in-place by d3.interpolate.
			function arcTween(a) {
							 var i = d3.interpolate(this._current, a);
							 this._current = i(0);
							 return function(t) {
								 return arc(i(t));
							 };
			}




</script>
</body>
</html>
